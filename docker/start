#!/bin/bash

set -o errexit
set -o pipefail
set -o nounset

#if [ ! -z "${BRANDING_FILES}" ]; then
#    git clone $BRANDING_FILES $PROJECT_PATH/$BRANDING_SLUG/
#    mv $PROJECT_PATH/$BRANDING_SLUG/$BRANDING_SLUG/ $PROJECT_PATH/static/brands/
#fi

python /app/manage.py collectstatic --noinput
if [ "${COMPRESS_ENABLED}" = true ]; then
    python /$PROJECT_PATH/manage.py compress --extension=.haml,.html --force
fi

#gunicorn --access-logfile - --workers 3 --bind unix:/run/gunicorn.sock temba.wsgi:application

echo "Starting NGINX service"
service nginx start

echo "Teste ========="
tail -f /dev/null

gunicorn temba.wsgi:application \
  --name=$PROJECT \
  --workers=3 \
  --user=$PROJECT \
  --bind=unix:/run/gunicorn.sock

#gunicorn temba.wsgi --log-config $PROJECT_PATH/docker/gunicorn/gunicorn-logging.conf -c $PROJECT_PATH/docker/gunicorn/gunicorn.conf.py
#python $PROJECT_PATH/manage.py runserver 0.0.0.0:8000
